<template>
  <div>
    <div class="features-container" id="beta">
      <div class="section-heading section-heading__features" id="beta-heading">
        <h1 class="section-heading__title">
          <img :src="premidBeta" />
        </h1>
      </div>
      <div class="container section-container section-container_reverse" id="beta-container">
        <div class="section-container__details">
          <h1 v-text="$t(`beta.title`)"></h1>
          <p v-html="this.$data.betaDescription + '<br />' + $t(`beta.description.2`)"></p>
          <ul>
            <li>
              <p v-text="$t(`beta.features.1`)"></p>
            </li>
            <li>
              <p v-text="$t(`beta.features.2`)"></p>
            </li>
            <li>
              <p v-text="$t(`beta.features.3`)"></p>
            </li>
          </ul>
        </div>
        <div class="section-container__promo">
          <video autoplay loop>
            <source src="./../assets/images/cards/card2_video.mp4" type="video/mp4" />
            <img class="section-container__promo--image2" :src="cardThumbnail2" />
          </video>
        </div>
      </div>
      <div class="beta-join">
        <p
          v-html="$t('beta.register.text')
            .replace('{0}', '<span class=\'text-highlight\'>' + betaUsers + '</span>')"
        ></p>
        <a href="/beta/register" class="button text--uppercase">{{$t(`beta.register.button`)}}</a>
      </div>
      <div class="waves-divider waves-divider_bottom">
        <svg
          class="wave"
          version="1.1"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 1440 100"
          preserveAspectRatio="none"
        >
          <path
            class="wave-animation"
            d="M826.337463,25.5396311 C670.970254,58.655965 603.696181,68.7870267 447.802481,35.1443383 C293.342778,1.81111414 137.33377,1.81111414 0,1.81111414 L0,150 L1920,150 L1920,1.81111414 C1739.53523,-16.6853983 1679.86404,73.1607868 1389.7826,37.4859505 C1099.70117,1.81111414 981.704672,-7.57670281 826.337463,25.5396311 Z"
            fill="currentColor"
          />
        </svg>
      </div>
    </div>
  </div>
</template>


<script>
import premidBeta from "@/assets/images/premid-beta.png";
import cardThumbnail2 from "@/assets/images/cards/card2.png";

import axios from "axios";

export default {
  name: "beta",
  auth: false,
  head() {
    return {
      title: "Beta"
    };
  },
  data() {
    return {
      premidBeta,
      cardThumbnail2,
      betaDescription: this.$t("beta.description.1")
    };
  },
  beforeMount() {
    this.betaUsers = this.$data.betaUsers;

    this.$data.betaDescription.match(/(\*\*.*?\*\*)/g).map((ch, i) => {
      this.$data.betaDescription = this.$data.betaDescription.replace(
        ch,
        `<span class="text-highlight">${ch.slice(2, ch.length - 2)}</span>`
      );
    });
  },
  async asyncData() {
    const credits = (await axios(`${process.env.apiBase}/credits`)).data;

    var betaUsers = 0;

    credits.map(user => {
      if (user.roles.includes("BETA")) betaUsers++;
    });

    return {
      betaUsers: betaUsers
    };
  }
};
</script>
